"use strict";var totalStep=10,baseUrl="https://www.zjtrain.cn",MyRadio={props:["value","label","keyValue"],template:'<div :class="elClass"><label><strong class="radio-strong"><input type="radio" :checked="value===label" @change="onInput"></strong><slot>{{label}}</slot></label></div>',methods:{onInput:function(){this.$emit("input",this.label)}},computed:{elClass:function(){return this.value===this.label?"radio-list selete-radio-list":"radio-list"}}},MySelect={props:["title","options","value"],template:'<div class="record-box">\n                        <div class="record-box-bd clearfix">\n                            <p class="record-text fl">{{title}}</p>\n                            <div class="selete-box fl">\n                                <div class="selete-box-hd" @click="showDrop">\n                                    <em class="selete-text">{{label}}</em>\n                                    <p class="text fr"><em class="xx-iconfont icon-xialajiantou"></em></p>\n                                </div>\n                                <div class="selete-box-bd" v-if="isShow">\n                                    <ul>\n                                        <li v-for="item,index in options" :key="item.value" @click.stop="onChange(index)">{{item.label}}</li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>',data:function(){return{isShow:!1,label:this.setLabel(this.value)}},methods:{setLabel:function(e){return(this.options[e]||{}).label||""},showDrop:function(){this.isShow=!this.isShow},hideDrop:function(){this.isShow=!1},onChange:function(e){this.label=this.setLabel(e),this.$emit("on-change",this.options[e]),this.hideDrop()}}};Vue.http.options.emulateJSON=!0;var stepMap=["","one","two","three","four","five","six","seven","eight","nine","ten"],vm=new Vue({el:"#calculation",components:{MyRadio:MyRadio,MySelect:MySelect},data:{isFormInit:!1,key:"",step:0,totalStep:totalStep,isShowError:!1,errMsg:"",isStartStep:!1,step1:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:function(e){return"持有 "+e+" 年"}}},step2:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:function(e){return"累计缴纳 "+e+" 年"}}},step3:{value:""},step4:{value:"对应社保缴费基数比例"},step5:{value:"以上皆无"},step6:{value:"以上皆无"},step7:{value:"普通民营企业",extraKey:["extra"],extra:{key:"2",value:"以上皆无",getLabel:function(e){return e}},options:[{value:"0",label:"科技企业"},{value:"1",label:"高薪技术认证企业"},{value:"2",label:"以上皆无"}]},step8:{value:"以上皆无"},step9:{value:"否"},step10:{value:"否"},rules:{required:["step1","step2","step3","step4","step5","step6","step7","step8","step9","step10"],step1:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step2:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step7:[{required:!0,condition:"extra",message:"请选择资质"}]}},computed:{processWidth:function(){return Math.ceil(this.step/totalStep*100)+"%"}},methods:{nextStep:function(){var e="step"+this.step,t=this,i=this[e],s=this.rules[e];if(!this.validate(e,i,s))return!1;var o=this.getValue(i);this.sendStep(o).then(function(e){var i=e.data||{};if(200!==i.code)return void this.showMsg(i.message||"请求错误");t.step>=10?t.showSubmitForm():t.step++},function(e){})},sendStep:function(e){var t=this;return this.$http.post(baseUrl+"/score/store",{key:t.key,step:stepMap[t.step]+"_step",answer:e})},showSubmitForm:function(){if(!this.isFormInit){this.isFormInit=!0,commonForm.el=null,commonForm.key=vm.key,commonForm.timer=5,commonForm.init({type:"zice",methodText:"落户自测"});var e=commonForm.getForm(),t=$("#test-form-title").html(),i=$("#test-form-footer").html();e.find(".j-form").addClass("test-form"),e.find(".j-form-footer").html(i),e.find(".j-form-footer .xx-button").on("click",function(){commonForm.resetTimer(),window.location.reload()}),commonForm.start()}commonForm.showForm()},onSelectChange7:function(e){this.step7.extra.value=e.label},preStep:function(){this.step--},validate:function(e,t,i){if(-1!==this.rules.required.indexOf(e)&&!String(t.value))return this.showMsg(),!1;if(i&&i.length)for(var s=0;s<i.length;s++){var o=i[s];if(o.condition){var n=t[o.condition]||{},a=n.value,r=n.conditionValue,l=void 0!==r&&t.value===r,u=void 0===r;if(l||u){if(o.required&&!String(a))return this.showMsg(o.message),!1;if("number"===o.type){var c=parseFloat(a);if(!c&&c!==c)return this.showMsg(o.message),!1}}}}return!0},showMsg:function(e){var t=this;this.errMsg=e||"您还有未填写的数据",this.isShowError=!0,setTimeout(function(){t.errMsg="",t.isShowError=!1},1e3)},getValue:function(e){var t=e.value,i=e.extraKey;return i&&i.length&&i.forEach(function(i){var s=e[i],o=void 0!==s.conditionValue&&e.value===s.conditionValue,n=void 0===s.conditionValue;(o||n)&&(t+=" "+s.getLabel(s.value))}),t},startStep:function(){var e=this;this.isStartStep=!0,setTimeout(function(){e.step++},10)}},watch:{},created:function(){this.key="test_pc_"+(new Date).getTime()}});