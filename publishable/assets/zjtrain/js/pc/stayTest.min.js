var totalStep=10,MyRadio={props:["value","label","keyValue"],template:'<div :class="elClass"><label><strong class="radio-strong"><input type="radio" :checked="value===label" @change="onInput"></strong><slot>{{label}}</slot></label></div>',methods:{onInput:function(){this.$emit("input",this.label)}},computed:{elClass:function(){return this.value===this.label?"radio-list selete-radio-list":"radio-list"}}},MySelect={props:["title","options","value"],template:'<div class="record-box">\n                        <div class="record-box-bd clearfix">\n                            <p class="record-text fl">{{title}}</p>\n                            <div class="selete-box fl">\n                                <div class="selete-box-hd" @click="showDrop">\n                                    <em class="selete-text">{{label}}</em>\n                                    <p class="text fr"><em class="xx-iconfont icon-xialajiantou"></em></p>\n                                </div>\n                                <div class="selete-box-bd" v-if="isShow">\n                                    <ul>\n                                        <li v-for="item,index in options" :key="item.value" @click.stop="onChange(index)">{{item.label}}</li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>',data(){return{isShow:!1,label:this.setLabel(this.value)}},methods:{setLabel:function(index){return(this.options[index]||{}).label||""},showDrop:function(){this.isShow=!this.isShow},hideDrop:function(){this.isShow=!1},onChange:function(index){this.label=this.setLabel(index),this.$emit("on-change",this.options[index]),this.hideDrop()}}};Vue.http.options.emulateJSON=!0;var stepMap=["","one","two","three","four","five","six","seven","eight","nine","ten"],vm=new Vue({el:"#calculation",components:{MyRadio:MyRadio,MySelect:MySelect},data:{isFormInit:!1,key:"",step:0,totalStep:totalStep,isShowError:!1,errMsg:"",isStartStep:!1,step1:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:value=>"持有 "+value+" 年"}},step2:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:value=>"累计缴纳 "+value+" 年"}},step3:{value:""},step4:{value:"对应社保缴费基数比例"},step5:{value:"以上皆无"},step6:{value:"以上皆无"},step7:{value:"普通民营企业",extraKey:["extra"],extra:{key:"2",value:"以上皆无",getLabel:value=>value},options:[{value:"0",label:"科技企业"},{value:"1",label:"高薪技术认证企业"},{value:"2",label:"以上皆无"}]},step8:{value:"以上皆无"},step9:{value:"否"},step10:{value:"否"},rules:{required:["step1","step2","step3","step4","step5","step6","step7","step8","step9","step10"],step1:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step2:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step7:[{required:!0,condition:"extra",message:"请选择资质"}]}},computed:{processWidth:function(){return Math.ceil(this.step/totalStep*100)+"%"}},methods:{nextStep:function(){var step="step"+this.step,self=this,data=this[step],rule=this.rules[step],valid;if(!this.validate(step,data,rule))return!1;var answer=this.getValue(data);this.sendStep(answer).then((function(res){var data=res.data||{};200===data.code?self.step>=10?self.showSubmitForm():self.step++:this.showMsg(data.message||"请求错误")}),(function(err){}))},sendStep:function(answer){var self=this;return this.$http.post("/score/store",{key:this.key,step:stepMap[this.step]+"_step",answer:answer,_token:document.getElementsByTagName("meta")["csrf-token"].getAttribute("content")})},showSubmitForm:function(){if(!this.isFormInit){this.isFormInit=!0,commonForm.el=null,commonForm.key=vm.key,commonForm.timer=5,commonForm.init({type:"zice",methodText:"落户自测"});var form=commonForm.getForm(),html=$("#test-form-title").html(),footer=$("#test-form-footer").html();form.find(".j-form").addClass("test-form"),form.find(".j-form-footer").html(footer),form.find(".j-form-footer .xx-button").on("click",(function(){commonForm.resetTimer(),location.href="/"})),commonForm.start()}commonForm.showForm()},onSelectChange7:function(data){this.step7.extra.value=data.label},preStep:function(){this.step--},validate:function(step,data,rule){var required;if(-1!==this.rules.required.indexOf(step)&&!String(data.value))return this.showMsg(),!1;if(rule&&rule.length)for(var i=0;i<rule.length;i++){var item=rule[i];if(item.condition){var condition=data[item.condition]||{},value=condition.value,conditionValue=condition.conditionValue,equalToSelectValue,notCompare;if(void 0!==conditionValue&&data.value===conditionValue||void 0===conditionValue){if(item.required&&!String(value))return this.showMsg(item.message),!1;if("number"===item.type){var ret=parseFloat(value);if(!ret&&ret!=ret)return this.showMsg(item.message),!1}}}}return!0},showMsg:function(msg){var self=this;this.errMsg=msg||"您还有未填写的数据",this.isShowError=!0,setTimeout((function(){self.errMsg="",self.isShowError=!1}),1e3)},getValue:function(data){var value=data.value,extraKey=data.extraKey;return extraKey&&extraKey.length&&extraKey.forEach((function(key){var extra=data[key],equalToSelectValue=void 0!==extra.conditionValue&&data.value===extra.conditionValue,notCompare=void 0===extra.conditionValue;(equalToSelectValue||notCompare)&&(value+=" "+extra.getLabel(extra.value))})),value},startStep:function(){var self=this;this.isStartStep=!0,setTimeout((function(){self.step++}),10)}},watch:{},created:function(){this.key="test_pc_"+(new Date).getTime()}});