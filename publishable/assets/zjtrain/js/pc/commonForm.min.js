"use strict";!function(){var e={phone:function(e){return/^((\+?0?86\-?)?)1\d{10}$/.test(e)}},t=function(){var t={el:null,timer:3,timeId:null,formType:"",methodText:"",rules:{name:[{required:!0,message:"*请填写称呼"}],phone:[{required:!0,message:"*请填写您的电话"},{type:"phone",message:"*请填写正确的电话"}]},getForm:function(){return this.el||(this.el=$("."+this.formClass)),this.el},validateField:function(t){var i=this.getForm(),n=this.rules[t],o=i.find("[name="+t+"]"),r=o.parent().find(".form-input-error");if(r.text(""),o.length)for(var s=o.val(),m=0;m<n.length;m++){var a=n[m];if(a.required&&!(a.type&&"string"!==a.type||s))return r.text(a.message),!1;var c=e[a.type];if(!(!c||c(s)))return r.text(a.message),!1}return!0},validateForm:function(){var e=this.rules,t=Object.keys(e);if(!t.length)return!1;for(var i=0;i<t.length;i++){if(!this.validateField(t[i]))return!1}return!0},prepareData:function(e){return Object.assign(e,{url:GuiJi.currentUrl,old_url:GuiJi.entranceWebUrl?GuiJi.entranceWebUrl:GuiJi.currentUrl,sourceChange:GuiJi.queryData,source:GuiJi.entranceUrlSource})},postForm:function(e,t){$.post("https://www.zjtrain.cnsite/form-input",e,t)},postFormZice:function(e,t){$.post("https://www.zjtrain.cn/score/store",e,t)},getImgCode:function(){var e=this.getForm();$.post("https://www.zjtrain.cn/site/img-code",function(t){e.find(".img-code").show(),e.find(".img-code").find(".code-i").html(t)})},onSuccess:function(){var e=this.getForm();this.resetForm(),e.find(".j-form").hide(),e.find(".form-success").show(),e.find(".img-code").hide()},bindFieldEvent:function(e){this.getForm().find("[name="+e+"]").on("blur",function(){t.validateField(e)})},bindSubmitBtn:function(){this.getForm().find(".j-submit").on("click",function(){t.submit()})},bindCloseBtn:function(){var e=function(){t.resetForm(),t.hideForm()},i=function(){t.hideForm(),t.resetTimer()},n=this.getForm();n.find(".j-form .form-close").on("click",e),$(".mask").on("click",e),n.find(".j-form-success .form-close").on("click",i)},submit:function(e,i,n){var o=this.validateForm(),r=this.getForm();if(o)if("zice"===this.formType){var s=this.prepareData({key:this.key,answer:"submit",name:r.find("[name=name]").val(),phone:r.find("[name=phone]").val(),img_code:r.find("[name=code]").val()||"",step:"submit"});this.postFormZice(s,function(e){1==e.img_code?t.getImgCode():(t.onSuccess(),t.startTimer(function(){window.location.reload();}))})}else{var s=t.prepareData({name:r.find("[name=name]").val(),phone:r.find("[name=phone]").val(),img_code:r.find("[name=code]").val()||"",info:t.getInfo&&t.getInfo()||"无",submit_time:(new Date).getTime(),method:this.methodText,one_source_id:e||9,two_source_id:i||17,three_source_id:n||103});t.postForm({data:s},function(e){1==e.img_code?t.getImgCode():(t.onSuccess(),"inline"!==t.formType&&t.startTimer())})}},resetForm:function(){var e=this.getForm();e.find("[name=name]").val(""),e.find("[name=phone]").val(""),e.find("[name=code]").val(""),e.find(".form-input-error").text("")},hideForm:function(){var e=this.getForm();e.find(".img-code").hide(),e.find(".j-form-success").hide(),$(".mask").hide(),e.hide()},resetTimer:function(){clearInterval(this.timeId),this.getForm().find(".j-form-success .timer").text("0"+this.timer+"s")},startTimer:function(e){var i=this.timer,n=this.getForm();t.timeId=setInterval(function(){i-=1,0===i?(t.hideForm(),t.resetTimer(),e&&e()):n.find(".j-form-success .timer").text("0"+i+"s")},1e3)},showForm:function(){var e=this.getForm();$(".mask").show(),e.find(".j-form").show(),e.show()},bindShowBtn:function(e){$(e).on("click",function(){t.showForm()})},init:function(e){e=e||{},this.formType=e.type||"",this.methodText=e.methodText,this.formClass=e.formClass||"j-common-form",e.showBtn&&this.bindShowBtn(e.showBtn)},start:function(){this.bindFieldEvent("name"),this.bindFieldEvent("phone"),this.bindSubmitBtn(),"inline"!==this.formType&&(this.bindCloseBtn(),this.resetTimer())}};return t},i=t();window.commonForm=i,window.makeForm=t}();