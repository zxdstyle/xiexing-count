"use strict";!function(){var e={phone:function(e){return/^((\+?0?86\-?)?)1\d{10}$/.test(e)}},i=function(){var i={el:null,timer:3,timeId:null,formType:"",methodText:"",isClick:!0,rules:{name:[{required:!0,message:"*请填写称呼"}],phone:[{required:!0,message:"*请填写您的电话"},{type:"phone",message:"*请填写正确的电话"}],address:[{required:!0,message:"*请填写地址"}]},getForm:function(){return this.el||(this.el=$("."+this.formClass)),this.el},validateField:function(i){var t,n=this.getForm(),r=this.rules[i],o=n.find("[name="+i+"]"),s=o.parents(".form-list").find(".form-input-error"),m=o.parent().find(".from-input-success");if(s.text(""),o.length)for(var a=o.val(),d=0;d<r.length;d++){var f=r[d];if(f.required&&(!f.type||"string"===f.type)){if(!a)return s.text(f.message),!1;"phone"!=i&&m.show()}var c,u=e[f.type];if(u?(c=u(a),t=!0):(c=!0,t=!1),!c)return s.text(f.message),m.hide(),!1;t&&c&&m.show()}return!0},validateForm:function(){var e=this.rules,i=Object.keys(e);if(!i.length)return!1;for(var t=0;t<i.length;t++){if(!this.validateField(i[t]))return!1}return!0},prepareData:function(e){return Object.assign(e,{url:GuiJi.currentUrl,old_url:GuiJi.entranceWebUrl?GuiJi.entranceWebUrl:-1!=GuiJi.entranceUrl.indexOf(location.origin)?GuiJi.entranceUrl:GuiJi.currentUrl,enter_url:GuiJi.entranceUrl,sourceChange:GuiJi.queryData,source:GuiJi.entranceUrlSource})},postForm:function(e,i){$.post("/site/form-input",e,i)},postFormZice:function(e,i){$.post("https://www.zjtrain.cn/score/store",e,i)},getImgCode:function(){var e=this.getForm();$.post("https://www.zjtrain.cn/site/img-code",function(i){e.find(".img-code").show(),e.find(".img-code").find(".code-i").html(i)}),i.isClick=!0},onSuccess:function(){var e=$(".mask"),i=this.getForm();this.resetForm(),"inline-alert"!==this.formType?i.find(".j-form").hide():i.find("ul li").eq(0).addClass("is-seleted").siblings().removeClass("is-seleted"),"books"!=this.formType&&(e.css({zIndex:100}),e.show()),i.find(".j-form-success").show(),i.find(".img-code").hide()},bindFieldEvent:function(e){this.getForm().find("[name="+e+"]").on("blur",function(){i.validateField(e)})},bindSubmitBtn:function(){this.getForm().find(".j-submit").on("click",function(){i.submit()})},bindCloseBtn:function(){var e=function(){i.resetForm(),i.hideForm()},t=function(){i.hideForm(),i.resetTimer()},n=this.getForm();n.find(".j-form .form-close").on("click",e),$(".mask").on("click",e),n.find(".j-form-success .form-close").on("click",t)},submit:function(e,t,n){var r=this.validateForm(),o=this.getForm();if(r){if(!i.isClick)return!1;if(i.isClick=!1,"zice"===this.formType){console.log("this.key",this.key);var s=this.prepareData({key:this.key,answer:"submit",name:o.find("[name=name]").val(),phone:o.find("[name=phone]").val(),img_code:o.find("[name=code]").val()||"",step:"submit"});this.postFormZice(s,function(e){1==e.img_code?i.getImgCode():(i.onSuccess(),i.startTimer(function(){location.href="/"}))})}else{var s=i.prepareData({name:o.find("[name=name]").val(),phone:o.find("[name=phone]").val(),img_code:o.find("[name=code]").val()||"",info:i.getInfo&&i.getInfo()||"",submit_time:(new Date).getTime(),method:this.methodText,one_source_id:e||9,two_source_id:t||17,three_source_id:n||103});i.postForm({data:s},function(e){if(1==e.img_code)i.getImgCode();else if(i.onSuccess(),"inline"!==i.formType&&"books"!==i.formType&&i.startTimer(),"books"===i.formType){var t={dayIdent:JSON.parse(GuiJi.tempId).dayIdent,num:JSON.parse(GuiJi.tempId).num-1,time:864e5,date:JSON.parse(GuiJi.tempId).date};GuiJi.tempId=JSON.stringify(t),localStorage.setItem("__guiji__",JSON.stringify(GuiJi)),$(".books-box .num").text(JSON.parse(GuiJi.tempId).num)}})}}},resetForm:function(){var e=this.getForm();e.find("[name=name]").val(""),e.find("[name=phone]").val(""),e.find("[name=code]").val(""),e.find("[name=address]").val(""),e.find(".form-input-error").text("")},hideForm:function(){var e=this.getForm(),i=$(".mask");e.find(".img-code").hide(),e.find(".j-form-success").hide(),i.css({zIndex:10}),i.hide(),"inline-alert"!==this.formType&&e.hide()},resetTimer:function(){clearInterval(this.timeId),this.getForm().find(".j-form-success .timer").text("0"+this.timer+"s")},startTimer:function(e){var t=this.timer,n=this.getForm();i.timeId=setInterval(function(){t-=1,0===t?(i.hideForm(),i.resetTimer(),e&&e()):n.find(".j-form-success .timer").text("0"+t+"s")},1e3)},showForm:function(){var e=this.getForm(),i=$(".mask");i.css({zIndex:100}),i.show(),e.find(".j-form").show(),e.show()},bindShowBtn:function(e){$(e).on("click",function(){i.showForm()})},init:function(e){e=e||{},this.formType=e.type||"",this.methodText=e.methodText,this.formClass=e.formClass||"m-j-common-form",e.showBtn&&this.bindShowBtn(e.showBtn)},start:function(){this.bindFieldEvent("name"),this.bindFieldEvent("phone"),this.bindSubmitBtn(),this.bindFieldEvent("address"),"inline"!==this.formType&&(this.bindCloseBtn(),this.resetTimer())}};return i},t=i();window.commonForm=t,window.makeForm=i}();