var totalStep=10,MyRadio={props:["value","label","keyValue"],template:'<div :class="elClass"><label><strong class="radio-strong"><input type="radio" :checked="value===label" @change="onInput"></strong><slot>{{label}}</slot></label></div>',methods:{onInput:function(){this.$emit("input",this.label)}},computed:{elClass:function(){return this.value===this.label?"radio-list selete-radio-list":"radio-list"}}},MySelect={props:["title","options","value"],template:'<div class="record-box">\n                        <div class="record-box-bd clearfix">\n                            <p class="record-text fl">{{title}}</p>\n                            <div class="selete-box fl">\n                                <div class="selete-box-hd" @click="showDrop">\n                                    <em class="selete-text">{{label}}</em>\n                                    <p class="text fr"><em class="xx-iconfont icon-xialajiantou"></em></p>\n                                </div>\n                                <div class="selete-box-bd" v-if="isShow">\n                                    <ul>\n                                        <li v-for="item,index in options" :key="item.value" @click.stop="onChange(index)">{{item.label}}</li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>',data(){return{isShow:!1,label:this.setLabel(this.value)}},methods:{setLabel:function(index){return(this.options[index]||{}).label||""},showDrop:function(){this.isShow=!this.isShow},hideDrop:function(){this.isShow=!1},onChange:function(index){this.label=this.setLabel(index),this.$emit("on-change",this.options[index]),this.hideDrop()}}};Vue.http.options.emulateJSON=!0;var stepMap=["","one","two","three","four","five","six","seven","eight","nine","ten"],vm=new Vue({el:"#mCalculation",components:{MyRadio:MyRadio,MySelect:MySelect},data:{headH:0,kongH:0,navH:0,calcHeight:0,boxHeight:0,kongHeight:0,noLayout:location.pathname.indexOf("wxapp")>-1,loading:!1,isFormInit:!1,key:"",step:0,totalStep:totalStep,isShowError:!1,errMsg:"",isStartStep:!1,step1:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:value=>"持有 "+value+" 年"}},step2:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:value=>"累计缴纳 "+value+" 年"}},step3:{value:""},step4:{value:"对应社保缴费基数比例"},step5:{value:"以上皆无"},step6:{value:"以上皆无"},step7:{value:"普通民营企业",extraKey:["extra"],extra:{key:"",value:"以上皆无",getLabel:value=>value},options:[{value:1,text:"科技企业"},{value:2,text:"高薪技术认证企业"},{value:3,text:"以上皆无"}]},step8:{value:"以上皆无"},step9:{value:"否"},step10:{value:"否"},rules:{required:["step1","step2","step3","step4","step5","step6","step7","step8","step9","step10"],step1:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step2:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step7:[{required:!0,condition:"extra",message:"请选择资质"}]}},computed:{processWidth:function(){return Math.ceil(this.step/totalStep*100)+"%"},isHeight:function(){return this.boxHeight>this.calcHeight}},methods:{updateBoxHeight:function(){this.calcHeight=this.getWindowHeight()-this.headH-this.kongH-this.navH,this.boxHeight=$(".step.step"+this.step).height()+this.kongHeight+$(".step-btn").height()},nextStep:function(){var step="step"+this.step,self=this,data=this[step],rule=this.rules[step],valid=this.validate(step,data,rule);if(this.loading)return!1;if(!valid)return!1;self.step>10&&self.showSubmitForm();var answer=this.getValue(data);this.loading=!0,this.sendStep(answer).then((function(res){var data=res.data||{};self.loading=!1,200===data.code?self.step>=10?self.showSubmitForm():(self.step++,self.updateBoxHeight()):this.showMsg(data.message||"请求错误")}),(function(err){self.loading=!1}))},sendStep:function(answer){var self=this;return this.$http.post("/score/store",{key:this.key,step:stepMap[this.step]+"_step",answer:answer,_token:document.getElementsByTagName("meta")["csrf-token"].getAttribute("content")})},successClose:function(){location.href="/"},showSubmitForm:function(){var form;this.isFormInit||(this.isFormInit=!0,$(".chang-service .form").addClass("test-form"),commonForm.key=this.key,commonForm.formType="zice",commonForm.el=null,commonForm.init({type:"zice",methodText:"落户自测"}),commonForm.start());console.log(1111),commonForm.showForm()},onSelectChange7:function(data){this.pickerFun(this.step7.options,"record",this.step7.extra,"key","value")},pickerFun:function(datas,idName,pickerValue,key,text){var picker1El=document.getElementById(idName).querySelector(".picker-text"),picker1=new Picker({data:[datas],selectedIndex:pickerValue&&key?[pickerValue[key]]:[0]});picker1.on("picker.select",(function(selectedVal,selectedIndex){picker1El.innerText=datas[selectedIndex].text,pickerValue&&text&&(pickerValue[text]=datas[selectedIndex].text)})),picker1.on("picker.change",(function(index,selectedIndex){})),picker1.on("picker.valuechange",(function(selectedVal,selectedIndex){pickerValue&&key&&(pickerValue[key]=selectedIndex[0])})),picker1.show()},preStep:function(){this.step--},validate:function(step,data,rule){var required;if(-1!==this.rules.required.indexOf(step)&&!String(data.value))return this.showMsg(),!1;if(rule&&rule.length)for(var i=0;i<rule.length;i++){var item=rule[i];if(item.condition){var condition=data[item.condition]||{},value=condition.value,conditionValue=condition.conditionValue,equalToSelectValue,notCompare;if(void 0!==conditionValue&&data.value===conditionValue||void 0===conditionValue){if(item.required&&!String(value))return this.showMsg(item.message),!1;if("number"===item.type){var ret=parseFloat(value);if(!ret&&ret!=ret)return this.showMsg(item.message),!1}}}}return!0},showMsg:function(msg){var self=this;this.errMsg=msg||"您还有未填写的数据",this.isShowError=!0,setTimeout((function(){self.errMsg="",self.isShowError=!1}),1e3)},getValue:function(data){var value=data.value,extraKey=data.extraKey;return extraKey&&extraKey.length&&extraKey.forEach((function(key){var extra=data[key],equalToSelectValue=void 0!==extra.conditionValue&&data.value===extra.conditionValue,notCompare=void 0===extra.conditionValue;(equalToSelectValue||notCompare)&&(value+=" "+extra.getLabel(extra.value))})),value},startStep:function(){var self=this;this.isStartStep=!0,setTimeout((function(){self.step++,self.updateBoxHeight()}),10)},getWindowHeight:function(){var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],y;return w.innerHeight||e.clientHeight||g.clientHeight}},watch:{},created:function(){this.key="test_m_"+(new Date).getTime()},mounted:function(){var nav=document.getElementById("nav");this.headH=document.getElementById("mHead")?document.getElementById("mHead").offsetHeight:0,this.kongH=document.getElementById("ft")?document.getElementById("ft").offsetHeight:0,this.navH=!this.noLayout&&nav?nav.offsetHeight:0,this.calcHeight=this.getWindowHeight()-this.headH-this.kongH-this.navH,this.kongHeight=document.getElementById("kong")?document.getElementById("kong").offsetHeight:0,this.boxHeight=$(".calc-box .section1").height()+this.kongHeight,$("input").on("blur",(function(){window.scroll(0,0)}))}});