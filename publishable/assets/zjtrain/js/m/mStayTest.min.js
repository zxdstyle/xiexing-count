"use strict";var totalStep=10,MyRadio={props:["value","label","keyValue"],template:'<div :class="elClass"><label><strong class="radio-strong"><input type="radio" :checked="value===label" @change="onInput"></strong><slot>{{label}}</slot></label></div>',methods:{onInput:function(){this.$emit("input",this.label)}},computed:{elClass:function(){return this.value===this.label?"radio-list selete-radio-list":"radio-list"}}},MySelect={props:["title","options","value"],template:'<div class="record-box">\n                        <div class="record-box-bd clearfix">\n                            <p class="record-text fl">{{title}}</p>\n                            <div class="selete-box fl">\n                                <div class="selete-box-hd" @click="showDrop">\n                                    <em class="selete-text">{{label}}</em>\n                                    <p class="text fr"><em class="xx-iconfont icon-xialajiantou"></em></p>\n                                </div>\n                                <div class="selete-box-bd" v-if="isShow">\n                                    <ul>\n                                        <li v-for="item,index in options" :key="item.value" @click.stop="onChange(index)">{{item.label}}</li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>',data:function(){return{isShow:!1,label:this.setLabel(this.value)}},methods:{setLabel:function(e){return(this.options[e]||{}).label||""},showDrop:function(){this.isShow=!this.isShow},hideDrop:function(){this.isShow=!1},onChange:function(e){this.label=this.setLabel(e),this.$emit("on-change",this.options[e]),this.hideDrop()}}};Vue.http.options.emulateJSON=!0;var stepMap=["","one","two","three","four","five","six","seven","eight","nine","ten"],vm=new Vue({el:"#mCalculation",components:{MyRadio:MyRadio,MySelect:MySelect},data:{headH:0,kongH:0,navH:0,calcHeight:0,boxHeight:0,kongHeight:0,noLayout:location.pathname.indexOf("wxapp")>-1,loading:!1,isFormInit:!1,key:"",step:0,totalStep:totalStep,isShowError:!1,errMsg:"",isStartStep:!1,step1:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:function(e){return"持有 "+e+" 年"}}},step2:{value:"",extraKey:["extra"],extra:{key:"",value:"",conditionValue:"是",getLabel:function(e){return"累计缴纳 "+e+" 年"}}},step3:{value:""},step4:{value:"对应社保缴费基数比例"},step5:{value:"以上皆无"},step6:{value:"以上皆无"},step7:{value:"普通民营企业",extraKey:["extra"],extra:{key:"",value:"以上皆无",getLabel:function(e){return e}},options:[{value:1,text:"科技企业"},{value:2,text:"高薪技术认证企业"},{value:3,text:"以上皆无"}]},step8:{value:"以上皆无"},step9:{value:"否"},step10:{value:"否"},rules:{required:["step1","step2","step3","step4","step5","step6","step7","step8","step9","step10"],step1:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step2:[{condition:"extra",required:!0,message:"请填写年份"},{condition:"extra",type:"number",message:"年份输入错误"}],step7:[{required:!0,condition:"extra",message:"请选择资质"}]}},computed:{processWidth:function(){return Math.ceil(this.step/totalStep*100)+"%"},isHeight:function(){return this.boxHeight>this.calcHeight}},methods:{updateBoxHeight:function(){this.calcHeight=this.getWindowHeight()-this.headH-this.kongH-this.navH,this.boxHeight=$(".step.step"+this.step).height()+this.kongHeight+$(".step-btn").height()},nextStep:function(){var e="step"+this.step,t=this,i=this[e],n=this.rules[e],o=this.validate(e,i,n);if(this.loading)return!1;if(!o)return!1;t.step>10&&t.showSubmitForm();var s=this.getValue(i);this.loading=!0,this.sendStep(s).then(function(e){var i=e.data||{};if(t.loading=!1,200!==i.code)return void this.showMsg(i.message||"请求错误");t.step>=10?t.showSubmitForm():(t.step++,t.updateBoxHeight())},function(e){t.loading=!1})},sendStep:function(e){var t=this;return this.$http.post("https://www.zjtrain.cn/score/store",{key:t.key,step:stepMap[t.step]+"_step",answer:e})},showSubmitForm:function(){if(!this.isFormInit){this.isFormInit=!0;var e=$(".chang-service .form"),t=$("#test-form-title").html();e.addClass("test-form"),commonForm.key=this.key,commonForm.formType="zice",commonForm.el=null,commonForm.init({type:"zice",methodText:"落户自测"}),commonForm.start()}commonForm.showForm()},onSelectChange7:function(e){this.pickerFun(this.step7.options,"record",this.step7.extra,"key","value")},pickerFun:function(e,t,i,n,o){var s=document.getElementById(t).querySelector(".picker-text"),a=new Picker({data:[e],selectedIndex:i&&n?[i[n]]:[0]});a.on("picker.select",function(t,n){s.innerText=e[n].text,i&&o&&(i[o]=e[n].text)}),a.on("picker.change",function(e,t){}),a.on("picker.valuechange",function(e,t){i&&n&&(i[n]=t[0])}),a.show()},preStep:function(){this.step--},validate:function(e,t,i){if(-1!==this.rules.required.indexOf(e)&&!String(t.value))return this.showMsg(),!1;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];if(o.condition){var s=t[o.condition]||{},a=s.value,r=s.conditionValue,l=void 0!==r&&t.value===r,h=void 0===r;if(l||h){if(o.required&&!String(a))return this.showMsg(o.message),!1;if("number"===o.type){var u=parseFloat(a);if(!u&&u!==u)return this.showMsg(o.message),!1}}}}return!0},showMsg:function(e){var t=this;this.errMsg=e||"您还有未填写的数据",this.isShowError=!0,setTimeout(function(){t.errMsg="",t.isShowError=!1},1e3)},getValue:function(e){var t=e.value,i=e.extraKey;return i&&i.length&&i.forEach(function(i){var n=e[i],o=void 0!==n.conditionValue&&e.value===n.conditionValue,s=void 0===n.conditionValue;(o||s)&&(t+=" "+n.getLabel(n.value))}),t},startStep:function(){var e=this;this.isStartStep=!0,setTimeout(function(){e.step++,e.updateBoxHeight()},10)},getWindowHeight:function(){var e=window,t=document,i=t.documentElement,n=t.getElementsByTagName("body")[0];return e.innerHeight||i.clientHeight||n.clientHeight}},watch:{},created:function(){this.key="test_pc_"+(new Date).getTime()},mounted:function(){var e=document.getElementById("nav");this.headH=document.getElementById("mHead")?document.getElementById("mHead").offsetHeight:0,this.kongH=document.getElementById("ft")?document.getElementById("ft").offsetHeight:0,this.navH=!this.noLayout&&e?e.offsetHeight:0,this.calcHeight=this.getWindowHeight()-this.headH-this.kongH-this.navH,this.kongHeight=document.getElementById("kong")?document.getElementById("kong").offsetHeight:0,this.boxHeight=$(".calc-box .section1").height()+this.kongHeight,$("input").on("blur",function(){window.scroll(0,0)})}});